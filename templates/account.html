{% extends "base.html" %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', path='css/account.css') }}">
{% endblock %}

{% block title %}Home{% endblock %}

{% block content %}
<h1>account Form</h1>
<p>Welcome, {{ firstname }}</p>

<ul id="ul-right">
  <!-- You can keep these hrefs; account.js intercepts them. -->
  <li><a href="/account" id="home-link" class="active" onclick="mylog(event)">Home</a></li>
  <li><a href="/dashboard" id="dashboard-link" onclick="goDashboard(event)">Dashboard</a></li>
  <li><a href="#contact">Contact</a></li>
  <li style="float:right"><a href="#about">About</a></li>
</ul>

<!--
  ‚úÖ Early, minimal token-responder.
  Placed BEFORE the iframe so if the iframe requests a token immediately,
  it gets a response even if account.js hasn't finished loading yet.
-->
<script>
  (function () {
    const ALLOWED_ORIGINS = [
      window.location.origin,
      "http://localhost:8000",
      "http://127.0.0.1:8000",
      // "https://YOUR_DOMAIN", // add your prod domain here
    ];
    function getToken() {
      try { return localStorage.getItem("access_token"); } catch { return null; }
    }
    window.addEventListener("message", function (event) {
      if (!ALLOWED_ORIGINS.includes(event.origin)) return;
      const data = event.data || {};
      if (data && data.requestToken) {
        const tk = getToken();
        if (tk && event.source) {
          event.source.postMessage({ token: tk }, event.origin);
          // console.log("üîÅ Inline head responder: sent token to iframe");
        }
      }
    }, true);
  })();
</script>

<!-- Chatbot iframe MUST keep this class, account.js relies on it -->
<iframe class="chatbot-frame" src="{{ url_for('chatbot') }}" width="100%" height="100%"></iframe>

<button id="open-chatbot-button" class="chatbot-toggle-button close">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9.5 11.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
  </svg>
</button>
{% endblock %}

{% block scripts %}
  <!-- Important: load as a module because account.js uses export -->
  <script type="module" src="{{ url_for('static', path='js/account.js') }}"></script>
{% endblock %}
